---
/**
 * SEO Preview Component
 * 
 * Componente de desarrollo para previsualizar c√≥mo se ver√° una p√°gina en Google
 * SOLO VISIBLE EN DESARROLLO (import.meta.env.DEV)
 * 
 * Uso:
 * <SEOPreview 
 *   title="T√≠tulo de la p√°gina"
 *   description="Descripci√≥n meta"
 *   url="https://commit.agency/ruta"
 * />
 */

export interface Props {
  title: string;
  description: string;
  url?: string;
}

const { title, description, url = Astro.url.href } = Astro.props;

// Truncar t√≠tulo si es muy largo (Google muestra ~60 caracteres)
const truncatedTitle = title.length > 60 ? title.substring(0, 57) + '...' : title;

// Truncar descripci√≥n (Google muestra ~160 caracteres)
const truncatedDesc = description.length > 160 ? description.substring(0, 157) + '...' : description;

// Extraer dominio de la URL
const domain = new URL(url).hostname;
const pathname = new URL(url).pathname;

// Warnings
const warnings: string[] = [];
if (title.length > 60) warnings.push(`‚ö†Ô∏è Title es muy largo (${title.length}/60 caracteres)`);
if (title.length < 30) warnings.push(`‚ö†Ô∏è Title es muy corto (${title.length}/30-60 caracteres)`);
if (description.length > 160) warnings.push(`‚ö†Ô∏è Description es muy larga (${description.length}/160 caracteres)`);
if (description.length < 120) warnings.push(`‚ö†Ô∏è Description es muy corta (${description.length}/120-160 caracteres)`);
if (!title.toLowerCase().includes('commit')) warnings.push('üí° Considera incluir "COMMIT" en el t√≠tulo');

// Solo mostrar en desarrollo
const isDev = import.meta.env.DEV;
---

{isDev && (
  <div class="seo-preview-container" style="
    position: fixed;
    bottom: 20px;
    right: 20px;
    z-index: 99999;
    background: white;
    border: 2px solid #e5e7eb;
    border-radius: 12px;
    box-shadow: 0 10px 40px rgba(0,0,0,0.1);
    padding: 20px;
    max-width: 600px;
    font-family: Arial, sans-serif;
  ">
    <div style="margin-bottom: 12px; display: flex; justify-content: space-between; align-items: center;">
      <strong style="font-size: 14px; color: #1f2937;">üîç Google SERP Preview</strong>
      <button 
        onclick="this.closest('.seo-preview-container').style.display='none'"
        style="
          background: none;
          border: none;
          font-size: 20px;
          cursor: pointer;
          color: #6b7280;
          padding: 0;
          width: 24px;
          height: 24px;
        "
      >√ó</button>
    </div>
    
    <!-- Google Preview -->
    <div style="
      background: #fff;
      border: 1px solid #e5e7eb;
      border-radius: 8px;
      padding: 12px;
      margin-bottom: 12px;
    ">
      <!-- URL breadcrumb -->
      <div style="
        font-size: 12px;
        color: #5f6368;
        margin-bottom: 4px;
        display: flex;
        align-items: center;
        gap: 4px;
      ">
        <span>{domain}</span>
        <span>‚Ä∫</span>
        <span>{pathname}</span>
      </div>
      
      <!-- Title -->
      <div style="
        font-size: 20px;
        color: #1a0dab;
        margin-bottom: 4px;
        font-weight: normal;
        line-height: 1.3;
        cursor: pointer;
      ">
        {truncatedTitle}
      </div>
      
      <!-- Description -->
      <div style="
        font-size: 14px;
        color: #4d5156;
        line-height: 1.58;
      ">
        {truncatedDesc}
      </div>
    </div>
    
    <!-- Stats -->
    <div style="
      font-size: 12px;
      color: #6b7280;
      display: flex;
      gap: 16px;
      margin-bottom: 8px;
    ">
      <span>Title: <strong>{title.length}</strong>/60</span>
      <span>Description: <strong>{description.length}</strong>/160</span>
    </div>
    
    <!-- Warnings -->
    {warnings.length > 0 && (
      <div style="
        background: #fef3c7;
        border: 1px solid #fbbf24;
        border-radius: 6px;
        padding: 8px;
        font-size: 12px;
        color: #92400e;
      ">
        {warnings.map(warning => (
          <div>{warning}</div>
        ))}
      </div>
    )}
    
    <!-- Success message -->
    {warnings.length === 0 && (
      <div style="
        background: #d1fae5;
        border: 1px solid #34d399;
        border-radius: 6px;
        padding: 8px;
        font-size: 12px;
        color: #065f46;
      ">
        ‚úÖ Metadata est√° optimizada!
      </div>
    )}
  </div>
)}

<style>
  .seo-preview-container:hover {
    box-shadow: 0 20px 50px rgba(0,0,0,0.15);
  }
</style>
