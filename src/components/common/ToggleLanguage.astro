---
import { Icon } from 'astro-icon/components';

export interface Props {
  iconClass?: string;
}

const { iconClass = 'w-6 h-6' } = Astro.props;
---

<button
  type="button"
  class="text-muted dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700 focus:outline-none focus:ring-4 focus:ring-gray-200 dark:focus:ring-gray-700 rounded-lg text-sm p-2.5 inline-flex items-center"
  aria-label="Cambiar idioma"
  data-aw-toggle-language
>
  <Icon name="tabler:language" class:list={[iconClass]} />
</button>

<script>
  function attachEvent() {
    const button = document.querySelector('[data-aw-toggle-language]');
    if (!button) {
      console.error('üî¥ Language button not found!');
      return;
    }

    button.addEventListener('click', () => {
      // Detectar idioma actual
      const currentLang = localStorage.getItem('language') || 'es';
      const newLang = currentLang === 'es' ? 'en' : 'es';
      
      console.log(`üåê Switching language: ${currentLang} ‚Üí ${newLang}`);
      
      // Guardar preferencia en localStorage
      localStorage.setItem('language', newLang);
      
      // Guardar en cookie para que el servidor lo detecte
      document.cookie = `language=${newLang}; path=/; max-age=31536000`; // 1 a√±o
      
      // Recargar p√°gina para aplicar nuevo idioma
      window.location.reload();
    });
  }

  // Aplicar idioma guardado al cargar la p√°gina
  function applyStoredLanguage() {
    const storedLang = localStorage.getItem('language') || 'es';
    document.documentElement.lang = storedLang;
    
    // Sincronizar cookie con localStorage
    document.cookie = `language=${storedLang}; path=/; max-age=31536000`;
  }

  applyStoredLanguage();
  attachEvent();
  document.addEventListener('astro:after-swap', attachEvent);
</script>
